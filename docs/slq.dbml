Table TipoAmostra {
    id SERIAL [pk]
    prefixo_amostra VARCHAR(10) [not null]
    cod_amostra VARCHAR(10) [not null]
    tipo_amostra VARCHAR(50) [not null]
    desc_amostra VARCHAR(300) [not null]
}

Table Analise {
    id SERIAL [pk]
    prefixo_metodo VARCHAR(20) [not null]
    cod_metodo VARCHAR(20) [not null]
    sigla_metodo VARCHAR(30) [not null]
    tipo_metodo VARCHAR(50) [not null]
    descricao_metodo VARCHAR(1000) [not null]
    unidade VARCHAR(50)
    valor_unitario NUMERIC(10,2)
    prazo_padrao INT
}

Table Modalidade {
  id SERIAL [pk]
  descricao VARCHAR(100) [not null]
}

Table Solicitante {
    id SERIAL [pk]
    nome VARCHAR(100) [not null]
    email VARCHAR(100) [not null]
    senha VARCHAR(255) [not null]
    telefone VARCHAR(20) [not null]
    userlevel INTEGER [not null]
    admlevel INTEGER [not null]
}

Table Solicitacao {
    id SERIAL [pk]
    id_solicitante INT [not null, ref: > Solicitante.id]
    id_modalidade INT [not null, ref: > Modalidade.id]
    id_direcao INTEGER [ref: > Direcao.id]
    cod_validade INT [not null]
    cod_lamir_cadastro VARCHAR(100) [not null]
    ano VARCHAR(4) [not null]
    unidade_departamento VARCHAR(100)
    instituicao VARCHAR(100)
    pais_instituicao VARCHAR(50)
    titulo_projeto VARCHAR(300)
    orientador_projeto VARCHAR(100)
    email_orientador VARCHAR(100)
    tipo_projeto VARCHAR(50)
    fonte_recursos VARCHAR(100)
    objetivo_projeto VARCHAR(500)
    status VARCHAR(50) [not null]
    data_status TIMESTAMP [not null]
    data_solicitacao TIMESTAMP [not null]
    confirmacao_orientador BOOLEAN
    data_confirmacao_orientador DATE 
    confirmacao_lamir BOOLEAN [not null]
    data_confirmacao_lamir DATE
    confirmacao_orcamento BOOLEAN [not null]
    data_confirmacao_orcamento DATE
    s_key VARCHAR(100) [not null]
    comentario VARCHAR(500)
    subtotal NUMERIC(10, 2)
    desconto FLOAT
    total NUMERIC(10, 2)
    ex_razao_social VARCHAR(255)
    ex_cpf VARCHAR(20)
    ex_cnpj VARCHAR(20)
    ex_data_nascimento DATE
    ex_rg VARCHAR(50)
    ex_inscricao_estadual VARCHAR(50)
    ex_inscricao_municipal VARCHAR(50)
    ex_endereco VARCHAR(255)
    ex_numero VARCHAR(10)
    ex_complemento VARCHAR(100)
    ex_bairro VARCHAR(100)
    ex_cidade VARCHAR(100)
    ex_uf CHAR(2)
    ex_cep VARCHAR(20)
    ex_pessoa_contato_financeiro VARCHAR(100)
    ex_telefone_financeiro VARCHAR(20)
    ex_email_financeiro VARCHAR(255)
    ex_pessoa_contato_certificado VARCHAR(100)
    ex_telefone_certificado VARCHAR(20)
    ex_email_certificado VARCHAR(255)
    ex_info_adicionais_certificado TEXT
    ex_solicitante VARCHAR(100)
}

Table Direcao {
    id SERIAL [pk]
    nome VARCHAR(100) [not null]
    email VARCHAR(100) [not null]
    ativo BOOLEAN [not null, default: true]
}

Table ItemSolicitacao {
    id SERIAL [pk]
    id_Solicitacao INT [not null, ref: > Solicitacao.id]
    id_amostra INT [not null, ref: > TipoAmostra.id]
    id_analise INT [not null, ref: > Analise.id]
    num_amostras INT [not null]
    descricao_amostra VARCHAR(300)
    preco_total_item NUMERIC(10, 2)
    preco_unitario NUMERIC(10, 2)
    aprovado_tecnico INT
    aprovado_direcao INT
    prazo INT
}

Table lamiremail {
  id SERIAL [pk]
	email VARCHAR(100)
}

Table HistoricoItemSolicitacao {
    id SERIAL [primary key]
    id_itemsolicitacao INT [not null, ref: > ItemSolicitacao.id]
    id_solicitacao INT [not null, ref: > Solicitacao.id]
    id_amostra INT [not null, ref: > TipoAmostra.id]
    id_analise INT [not null, ref: > Analise.id]
    num_amostras INT [not null]
    descricao_amostra VARCHAR(300)
    preco_total_item NUMERIC(10, 2)
    data_modificacao TIMESTAMP [not null, default: `CURRENT_TIMESTAMP`]
}

TABLE EmailLog {
    id SERIAL [PRIMARY KEY]
    id_solicitacao INTEGER [not null, ref: > Solicitacao.id]
    destinatario VARCHAR(255)
    assunto VARCHAR(255)
    corpo TEXT
    tipo VARCHAR(50)
    tentativas INTEGER [note: 'DEFAULT 0']
    enviado BOOLEAN [note: 'DEFAULT FALSE']
    ultima_tentativa TIMESTAMP
    criado_em TIMESTAMP [note: 'DEFAULT NOW()']
    sucesso boolean [note: 'DEFAULT FALSE']
    erro text
    data_envio timestamp
}

Table AmostraMetodoPermitido {
    id SERIAL [pk]
    id_tipo_amostra INT [not null, ref: > TipoAmostra.id, unique]
    id_analise INT [not null, ref: > Analise.id, unique]
    permitido BOOLEAN [not null, default: false]
    created_at TIMESTAMP [default: `CURRENT_TIMESTAMP`]
    updated_at TIMESTAMP [default: `CURRENT_TIMESTAMP`]
    Note: 'Unique constraint on (id_tipo_amostra, id_analise)'
}

Enum tipo_resposta_seguranca {
  Sim
  Nao
  "Nao Tenho Certeza" // Aspas são usadas por causa do espaço no nome
}

Table UnidadeAmostra {
  id SERIAL [pk]
  id_item_solicitacao INT [not null, ref: > ItemSolicitacao.id]
  numero_sequencial INT [not null, note: 'Número sequencial da amostra dentro do item (ex: 1 de 5)']
  identificacao_amostra VARCHAR(100) [not null, note: 'Código ou nome único dado pelo solicitante para esta amostra']
  
  // Campos descritivos
  origem_amostra VARCHAR(500)
  componentes_principais VARCHAR(300)
  
  // --- Questionário de Segurança da Amostra ---
  seg_atividade_radioativa tipo_resposta_seguranca [not null]
  seg_possui_amonia tipo_resposta_seguranca [not null]
  seg_libera_gas_sulfidrico tipo_resposta_seguranca [not null]
  seg_possui_chumbo tipo_resposta_seguranca [not null]
  seg_possui_mercurio tipo_resposta_seguranca [not null]
  seg_risco_biologico tipo_resposta_seguranca [not null]
  seg_risco_quimico tipo_resposta_seguranca [not null]
  seg_material_inflamavel tipo_resposta_seguranca [not null]
  seg_observacoes TEXT [note: 'Campo para observações adicionais de segurança']
}
